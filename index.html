<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NamesUnder</title>
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

<h1>NamesUnder</h1>
<p>Good domains. Under Market.</p>

<div class="search-box">
  <input id="search" type="text" placeholder="Search domains...">
</div>

<div class="filters">
  <select id="category-filter">
    <option value="">All categories</option>
    <!-- las opciones se van a agregar automáticamente con JS -->
  </select>
</div>

<div id="list"></div>

<script>
let allDomains = [];

function renderList(domains) {
  const list = document.getElementById('list');

  if (!domains.length) {
    list.innerHTML = `<p>No domains found.</p>`;
    return;
  }

  list.innerHTML = domains.map(d => `
    <div class="item">
      <span class="domain">${d.domain}</span>
      <span class="price">$${d.price}</span>
      <a class="buy" href="/domain/?d=${encodeURIComponent(d.domain)}">View</a>
    </div>
  `).join('');
}

function applyFilters() {
  const searchInput = document.getElementById('search');
  const categorySelect = document.getElementById('category-filter');

  const q = (searchInput.value || '').trim().toLowerCase();
  const cat = (categorySelect.value || '').trim().toLowerCase();

  const filtered = allDomains.filter(d => {
    const matchesSearch = d.domain.toLowerCase().includes(q);
    const matchesCategory = !cat || (d.category && d.category.toLowerCase() === cat);
    return matchesSearch && matchesCategory;
  });

  renderList(filtered);
}

// Cargar dominios al inicio
fetch('/data/domains.json')
  .then(r => r.json())
  .then(domains => {
    allDomains = domains;

    // Poblar opciones de categoría automáticamente
    const catSelect = document.getElementById('category-filter');
    const categories = Array.from(
      new Set(
        allDomains
          .map(d => d.category)
          .filter(Boolean) // saca null/undefined/vacíos
      )
    ).sort();

    categories.forEach(cat => {
      const opt = document.createElement('option');
      opt.value = cat;
      opt.textContent = cat;
      catSelect.appendChild(opt);
    });

    // Render inicial
    renderList(allDomains);

    // Eventos de filtro
    const searchInput = document.getElementById('search');
    if (searchInput) {
      searchInput.addEventListener('input', applyFilters);
    }
    if (catSelect) {
      catSelect.addEventListener('change', applyFilters);
    }
  });
</script>

</body>
</html>
